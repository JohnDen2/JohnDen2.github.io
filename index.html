<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Excel Data Display</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
</head>
<body>
    <h1 id="page-title">Excel Data</h1> <!-- Static title -->
    <div id="result"></div>
    <div id="loading" style="display: none;">Loading...</div> <!-- Loading indicator -->
    
    <script>
        const filePath = 'https://keystonecablesg-my.sharepoint.com/:x:/g/personal/john_deniola_keystone-cable_com/EUgQ7wBBYY9DhbO6vtW563QBWwHdQIps4lc4QpERnKE-1Q?e=I7mt9D'; // Replace this with your actual URL

        // Function to get query parameters from the URL
        const getQueryParam = (param) => {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get(param);
        };

        // Get the row number from the query parameter (default to 3 if not provided)
        const rowNumber = parseInt(getQueryParam('row')) || 3;

        document.getElementById('loading').style.display = 'block'; // Show loading

        fetch(filePath)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Network response was not ok: ${response.status} ${response.statusText}`);
                }
                return response.arrayBuffer();
            })
            .then(data => {
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];

                // Convert the sheet into an array of rows (header: 1 means use the first row as the header)
                const rows = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });

                // Check if there are enough rows
                if (rows.length >= rowNumber) {
                    // Access the row data (adjust for zero-based index)
                    const rowData = rows[rowNumber - 1]; // rowNumber is 1-based, so subtract 1 for zero-based indexing

                    // Function to format the date as dd/mm/yy
                    const formatDate = (cell) => {
                        if (cell && cell.t === 'n' && cell.v) {
                            const date = XLSX.SSF.parse_date_code(cell.v);
                            const day = String(date.d).padStart(2, '0');
                            const month = String(date.m).padStart(2, '0');
                            const year = String(date.y).slice(-2);
                            return `${day}/${month}/${year}`;
                        }
                        return 'Invalid Date';
                    };

                    // Extract the required data from the row
                    const refNo = rowData[0] || 'Ref. No. not found';
                    const modelNumber = rowData[2] || 'Model Number not found';
                    const serialNumber = rowData[3] || 'Serial Number not found';
                    const calDate = rowData[4] ? formatDate(rowData[4]) : 'Invalid Date';
                    const dueDate = rowData[5] ? formatDate(rowData[5]) : 'Invalid Date';
                    const calAgent = rowData[6] || 'Cal. Agent not found';
                    const location = rowData[7] || 'Location not found';
                    const reportNo = rowData[8] || 'Report No. not found';
                    const title = rowData[1] || 'Default Title';

                    // Set the page title dynamically
                    document.title = title;
                    document.getElementById('page-title').innerText = title;

                    // Display the results
                    const result = `
                        <strong>Ref. No.:</strong> ${refNo} <br>
                        <strong>Model Number:</strong> ${modelNumber} <br>
                        <strong>Serial Number:</strong> ${serialNumber} <br>
                        <strong>Cal. Date:</strong> ${calDate} <br>
                        <strong>Due Date:</strong> ${dueDate} <br>
                        <strong>Cal. Agent:</strong> ${calAgent} <br>
                        <strong>Location:</strong> ${location} <br>
                        <strong>Report No.:</strong> ${reportNo}
                    `;

                    document.getElementById('result').innerHTML = result;
                } else {
                    document.getElementById('result').innerText = 'Row data not found.';
                }

                document.getElementById('loading').style.display = 'none'; // Hide loading
            })
            .catch(error => {
                console.error('Error loading file:', error);
                document.getElementById('result').innerText = `Error loading file: ${error.message}`;
                document.getElementById('loading').style.display = 'none'; // Hide loading
            });
    </script>
</body>
</html>
