<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">Excel Data</title> <!-- Dynamic title will be set in JavaScript -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>
</head>
<body>
    <h1 id="dynamic-title">Excel Data</h1> <!-- Placeholder for the title -->
    <div id="result"></div>
    <script>
        const fileId = '1TJVnaaskSayy8CHQRQOwzTs3NPNZBHcI'; // Replace with your actual file ID
        const filePath = `https://docs.google.com/spreadsheets/d/${fileId}/export?format=xlsx&t=${new Date().getTime()}`;

        fetch(filePath)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`Network response was not ok: ${response.status} ${response.statusText}`);
                }
                return response.arrayBuffer();
            })
            .then(data => {
                const workbook = XLSX.read(data, { type: 'array' });
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];

                // Define the cells to check
                const refNoCell = 'A3';
                const titleCell = 'B3';
                const modelCell = 'C3';
                const serialCell = 'D3';
                const calDateCell = 'E3';
                const dueDateCell = 'F3';
                const calAgentCell = 'G3';
                const locationCell = 'H3';
                const reportNoCell = 'I3';

                // Function to format the date
                const formatDate = (cell) => {
                    if (cell && cell.t === 'n' && cell.v) { // Check if the cell is a number and has a value
                        const date = XLSX.SSF.parse_date_code(cell.v);
                        return new Date(date.y, date.m - 1, date.d).toLocaleDateString();
                    }
                    return 'Invalid Date';
                };

                // Get the values
                const refNo = firstSheet[refNoCell] ? firstSheet[refNoCell].v : 'Ref. No. not found';
                const title = firstSheet[titleCell] ? firstSheet[titleCell].v : 'Title not found';
                const modelNumber = firstSheet[modelCell] ? firstSheet[modelCell].v : 'Model Number not found';
                const serialNumber = firstSheet[serialCell] ? firstSheet[serialCell].v : 'Serial Number not found';
                const calDate = formatDate(firstSheet[calDateCell]);
                const dueDate = formatDate(firstSheet[dueDateCell]);
                const calAgent = firstSheet[calAgentCell] ? firstSheet[calAgentCell].v : 'Cal. Agent not found';
                const location = firstSheet[locationCell] ? firstSheet[locationCell].v : 'Location not found';
                const reportNo = firstSheet[reportNoCell] ? firstSheet[reportNoCell].v : 'Report No. not found';

                // Set the page title dynamically
                document.title = title;
                document.getElementById('dynamic-title').innerText = title;

                // Display the results
                const result = `
                    <strong>Ref. No.:</strong> ${refNo} <br>
                    <strong>Model Number:</strong> ${modelNumber} <br>
                    <strong>Serial Number:</strong> ${serialNumber} <br>
                    <strong>Cal. Date:</strong> ${calDate} <br>
                    <strong>Due Date:</strong> ${dueDate} <br>
                    <strong>Cal. Agent:</strong> ${calAgent} <br>
                    <strong>Location:</strong> ${location} <br>
                    <strong>Report No.:</strong> ${reportNo}
                `;

                document.getElementById('result').innerHTML = result;
            })
            .catch(error => {
                console.error('Error loading file:', error);
                document.getElementById('result').innerText = `Error loading file: ${error.message}`;
            });
    </script>
</body>
</html>
